---
import Yo from '@imgs/yo.webp'
import Pill from './Pill.astro'
import Email from '@icons/Mail.astro'
import GitHub from '@icons/GitHub.astro'
import LinkedIn from '@icons/LinkedIn.astro'
import Send from '@icons/Send.astro'
import Copy from '@icons/Copy.astro'
import CV from '../assets/cv/CV_ROSENDO_GARCIA.pdf'
import CVIcon from '@icons/CV.astro'

import { getI18N } from '@c/i18n'
import { unescapeHTML } from 'astro/compiler-runtime'

const { currentLocale } = Astro
const i18n = getI18N({ currentLocale })

let paragraph = i18n.PERSONAL_INFO.PARAGRAPH
let phrases = i18n.PERSONAL_INFO.PHRASES

for (let phrase in phrases) {
  let replacement = `<span class="${phrases[phrase as keyof typeof phrases]}">${phrase}</span>`
  paragraph = paragraph.split(phrase).join(replacement)
}

const htmlParagraph = unescapeHTML(paragraph)
---

<div class="flex flex-col text-left w-full place-items-center p-1">
  <section class="grid gap-3 text-white">
    <img src={Yo.src} alt='It should be me' class="md:w-24 w-16 h-auto md:rounded rounded" loading="lazy"/>
    <div class="flex flex-row items-center gap-1">
      <h1 class="md:text-3xl text-2xl">{i18n.PERSONAL_INFO.GREETING}</h1>
      <a href="https://www.linkedin.com/in/rosendo-garcia-a498b9279/" target="_blank" class="text-blue-700 transition bg-slate-300 hover:text-white border border-blue-700 hover:bg-blue-800 font-medium rounded-lg md:text-sm text-xs px-2 py-1 text-center me-3 mb-2">
        {i18n.PERSONAL_INFO.PILL_MESSAGE}
      </a>
    </div>
    <p class="text-lg">{htmlParagraph}</p>
  </section>
  <nav class="flex gap-4 m-3 flex-wrap md:w-[70%] w-[90%] place-items-center justify-center">
    <Pill href="https://github.com/Roosendo" class="cursor-pointer">
      <GitHub class="md:size-5 size-4 text-emerald-400" />
      <span class="text-white/80 md:text-base text-sm">GitHub</span>
    </Pill>
    <Pill href="https://www.linkedin.com/in/rosendo-garcia-a498b9279/" class="cursor-pointer">
      <LinkedIn class="md:size-5 size-4 text-emerald-400" />
      <span class="text-white/80 md:text-base text-sm">LinkedIn</span>
    </Pill>
    <Pill href={CV} class="cursor-pointer">
      <CVIcon class="md:size-5 size-4 text-emerald-400" />
      <span class="text-white/80 md:text-base text-sm">CV</span>
    </Pill>
  </nav>
  <div class="hidden items-center p-4 mt-3 text-sm rounded-lg bg-gray-800 text-blue-400" role="alert" id="alert-ok">
    <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
      <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
    </svg>
    <span class="sr-only">Info</span>
    <div>
      <span class="font-medium">{i18n.PERSONAL_INFO.ALERTS.SUCCESS}</span>
    </div>
  </div>
  <div class="hidden items-center p-4 mt-3 text-sm rounded-lg bg-gray-800 text-red-400" id="alert-no" role="alert">
    <svg class="flex-shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
      <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
    </svg>
    <span class="sr-only">Info</span>
    <div>
      <span class="font-medium">{i18n.PERSONAL_INFO.ALERTS.ERROR}</span>
    </div>
  </div>
  <div class="flex flex-row gap-3 mb-3 text-white items-center w-full mt-3">
    <Email class="md:size-5 size-4" />
    <h2 class="md:text-base text-md">{i18n.PERSONAL_INFO.EMAIL}</h2>
  </div>
  <div class="flex flex-row gap-4 w-full justify-center">
    <div class="inline-flex rounded-md shadow-sm w-full justify-center" role="group">
      <div class="inline-flex items-center px-3 py-2 text-white bg-transparent border border-gray-200 rounded-s-lg">
        <p class="md:text-base text-xs">rosendo.garcia73@outlook.com</p>
      </div>
      <a href="mailto:rosendo.garcia73@outlook.com" aria-label="Button to send an email from any email app" class="inline-flex items-center md:px-3 md:py-2 px-2 py-1 gap-1 text-gray-900 bg-white/80 border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700">
        <Send class="md:size-5 size-4 text-[#2e2e2e]" />
      </a>
      <button type="button" id="to-copy" aria-label="Button to copy the email" class="inline-flex items-center md:px-3 md:py-2 px-2 py-1 gap-1 text-gray-900 bg-white/80 border border-gray-200 rounded-e-lg hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700">
        <Copy class="md:size-5 size-4 text-[#2e2e2e]" />
      </button>
    </div>
  </div>
</div>

<script>
  import { copyToClipboard } from '@u/CopyFunctionality'
  import { showAndHideAlert } from '@u/ShowAndHideAlert'

  const email = 'rosendo.garcia73@outlook.com'
  const button = document.querySelector('#to-copy') as HTMLButtonElement
  const alertOk = document.querySelector('#alert-ok') as HTMLDivElement
  const alertNo = document.querySelector('#alert-no') as HTMLDivElement

  if (button && alertOk && alertNo) {
    button.addEventListener('click', async () => {
      const successfull = copyToClipboard(email)

      if (successfull) {
        showAndHideAlert(alertOk)
      } else {
        showAndHideAlert(alertNo)
      }
    })
  } else {
    console.error('Something went wrong')
  }

</script>
